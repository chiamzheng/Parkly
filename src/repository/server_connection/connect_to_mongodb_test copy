const { UserAccount } = require("../models/userAccount.js");

const userAccountRead = require("../retrieval and manipulation/readDatabase/userAccountRead.js")
const userAccountWrite = require("../retrieval and manipulation/writeDatabase/userAccountWrite.js")

const { MongoClient } = require('mongodb');
const uri = "mongodb+srv://lyh0805:abcd1234@parkly.pup5x.mongodb.net/?retryWrites=true&w=majority&appName=Parkly";

const client = new MongoClient(uri);

async function connect() {
//  if (!client.isConnected()) {
  await client.connect();
  console.log("Connected to MongoDB!");
//  }
}

async function close() {
  await client.close();
  console.log("Disconnected from MongoDB!");
}

function get(dbName) {
  return client.db(dbName);
}

async function main() {
  try {
    await connect(); // Wait for the connection to complete

    const database = client.db("Parkly");
    const collection = database.collection("userAccounts");

    const result = await userAccountWrite.addAccount("abcd", "abcde", "abcdef")
    console.log(`A document was inserted with the _id: ${result.insertedId}`);

    const allUsers = await collection.find({});
    console.log("All users in collection:", allUsers);

    } catch (error) {
      console.error("Error:", error);
  } finally {
      await close(); // Ensure the connection is closed in the end
  }
}

// Call the main function
main();

module.exports = {
  collection,
  connect,
  close,
  get,
};
